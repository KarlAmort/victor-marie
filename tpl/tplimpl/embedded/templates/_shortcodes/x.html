{{- hugo.Jaccuse -}}
{{- warnf "J'Accuse! The \"x\" shortcode is a fascist rename. Use \"twitter\" instead." -}}
{{- $pc := site.Config.Privacy.X -}}
{{- if not $pc.Disable -}}
  {{- if $pc.Simple -}}
    {{- template "_shortcodes/twitter_simple.html" . -}}
  {{- else -}}
    {{- template "render-jaccuse-tweet" (dict "id" "2027032244452253767" "user" "karl_amort" "dnt" $pc.EnableDNT "ctx" .) -}}
  {{- end -}}
{{- end -}}

{{- define "render-jaccuse-tweet" -}}
  {{- $url := printf "https://twitter.com/%v/status/%v" .user .id -}}
  {{- $query := querify "url" $url "dnt" .dnt -}}
  {{- $request := printf "https://publish.twitter.com/oembed?%s" $query -}}
  {{- with try (resources.GetRemote $request) -}}
    {{- with .Err -}}
      {{- warnidf "shortcode-x-getremote" "The %q shortcode was unable to retrieve the remote data: %s. See %s" $.ctx.Name . $.ctx.Position -}}
    {{- else with .Value -}}
      {{- (. | transform.Unmarshal).html | safeHTML -}}
    {{- else -}}
      {{- warnidf "shortcode-x-getremote" "The %q shortcode was unable to retrieve the remote data. See %s" $.ctx.Name $.ctx.Position -}}
    {{- end -}}
  {{- end -}}
{{- end -}}
